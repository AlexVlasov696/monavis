<?php define('WP_USE_THEMES', false); require_once('../../../wp-load.php'); global $wbpb,$woocommerce; ?><?php ini_set('default_charset', 'UTF-8'); header('Content-Type: application/json'); ?><?php $action = $_POST['action']; $productID = $_POST['product_id']; $quantity = $_POST['quantity'];$key = $_POST['key']; ?><?php if($action == 'add_product' && !empty($productID) && intval($quantity) > 0 ): ?><?php if($woocommerce->cart->add_to_cart($productID, intval($quantity))): ?><?php $cart = $woocommerce->cart->get_cart();$data = array(); $i = 0; ?><?php foreach($cart as $index=>$product): ?><?php $data['products'][$i]['id'] = $product['product_id'];$data['products'][$i]['key'] = $index;$data['products'][$i]['variation'] = $product['variation_id'];$data['products'][$i]['name'] = $product['data']->post->post_title;$data['products'][$i]['quantity'] = $product['quantity'];$data['products'][$i]['price'] = wc_price($product['line_total']); ?><?php $i++; ?><?php endforeach; ?><?php $data['total_price'] = $woocommerce->cart->get_cart_total();$data['total_count'] = $woocommerce->cart->cart_contents_count; ?><?php print(json_encode($data)); ?><?php else: ?><?php print(json_encode(array('status'=>'error','error'=>'woo add error'))); ?><?php endif; ?><?php elseif($action == 'remove_product' && !empty($key)): ?><?php if($woocommerce->cart->remove_cart_item($key)): ?><?php $cart = $woocommerce->cart->get_cart();$data = array(); $i = 0; ?><?php foreach($cart as $index=>$product): ?><?php $data['products'][$i]['id'] = $product['product_id'];$data['products'][$i]['key'] = $index;$data['products'][$i]['variation'] = $product['variation_id'];$data['products'][$i]['name'] = $product['data']->post->post_title;$data['products'][$i]['quantity'] = $product['quantity'];$data['products'][$i]['price'] = wc_price($product['line_total']); ?><?php $i++; ?><?php endforeach; ?><?php $data['total_price'] = $woocommerce->cart->get_cart_total();$data['total_count'] = $woocommerce->cart->cart_contents_count; ?><?php print(json_encode($data)); ?><?php else: ?><?php print(json_encode(array('status'=>'error','error'=>'woo remove error'))); ?><?php endif; ?><?php else: ?><?php print(json_encode(array('status'=>'error','error'=>'post error'))); ?><?php endif; ?>